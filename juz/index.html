<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Juz 8 Dynamic Questions</title>
    <!-- Material Design stylesheet -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Material Design icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Custom styles -->
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
            text-align: center;
            background-color: #fafafa;
        }

        #main-container {
            margin-top: 50px;
            margin-bottom: 50px;
        }

        .card {
            margin-bottom: 20px;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
        }

        .card .card-content {
            padding: 20px;
        }

        .card .card-action {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #008080;
            text-align: center;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 16px;
            color: #333;
            margin: 20px 0;
            line-height: 1.8;
        }

        .verse-text {
            font-size: 18px;
            color: #008080;
            font-weight: 600;
            margin: 15px 0;
            direction: rtl;
            text-align: right;
        }

        .options-container {
            margin: 20px 0;
            text-align: left;
            display: inline-block;
            width: 100%;
            max-width: 600px;
        }

        .option {
            margin: 12px 0;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background-color: #fff;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: #008080;
            background-color: #f5f5f5;
        }

        .option.selected {
            background-color: #008080;
            color: white;
            border-color: #008080;
        }

        .option.correct {
            background-color: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .option.incorrect {
            background-color: #f44336;
            color: white;
            border-color: #f44336;
        }

        .btn {
            background-color: #008080;
            margin-top: 20px;
        }

        .btn:hover {
            background-color: #006666;
        }

        .btn-secondary {
            background-color: #999;
        }

        .btn-secondary:hover {
            background-color: #666;
        }

        .result-text {
            font-size: 16px;
            font-weight: 600;
            margin-top: 15px;
        }

        .result-correct {
            color: #4caf50;
        }

        .result-incorrect {
            color: #f44336;
        }

        .question-counter {
            font-size: 14px;
            color: #999;
            margin-bottom: 10px;
        }

        .full-verse {
            background-color: #f9f9f9;
            padding: 15px;
            border-left: 4px solid #008080;
            text-align: right;
            direction: rtl;
            margin: 15px 0;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .card {
                width: 95%;
            }

            .question-text {
                font-size: 14px;
            }

            .verse-text {
                font-size: 16px;
            }

            .option {
                font-size: 14px;
                padding: 10px 12px;
            }
        }
    </style>
</head>

<body>
    <div id="main-container">
        <h1 style="color: #008080;">Juz 8 Questions</h1>
        <div id="content">
            <!-- Question Type Selection Screen -->
            <div id="selection-screen" class="card">
                <div class="card-content">
                    <h3 style="color: #008080; margin-bottom: 20px;">Select Question Types</h3>
                    <p style="color: #666; margin-bottom: 20px;">Choose which types of questions you'd like to practice:</p>
                    
                    <div style="text-align: left; display: inline-block;">
                        <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer; font-size: 16px;">
                            <input type="checkbox" id="type1" checked style="margin-right: 10px; cursor: pointer;">
                            <span>Verse ends with X → starts with Y</span>
                        </label>
                        <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer; font-size: 16px;">
                            <input type="checkbox" id="type2" checked style="margin-right: 10px; cursor: pointer;">
                            <span>Verse starts with X → ends with Y</span>
                        </label>
                        <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer; font-size: 16px;">
                            <input type="checkbox" id="type3" checked style="margin-right: 10px; cursor: pointer;">
                            <span>What is the next verse?</span>
                        </label>
                        <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer; font-size: 16px;">
                            <input type="checkbox" id="type4" checked style="margin-right: 10px; cursor: pointer;">
                            <span>What is the previous verse?</span>
                        </label>
                    </div>
                </div>
                <div class="card-action">
                    <button class="btn waves-effect waves-light" onclick="startQuiz()">Start</button>
                </div>
            </div>

            <!-- Question Screen -->
            <div id="question-screen" style="display: none;">
                <div class="progress" style="margin: 20px auto; width: 80%; max-width: 600px;">
                    <div class="determinate" id="progress-bar" style="width: 0%; background-color: #008080;"></div>
                </div>
                <div class="card">
                    <div class="card-content">
                        <div class="question-counter">
                            Question <span id="current-question">1</span>
                        </div>
                        <div class="card-title" id="question-title">Loading...</div>
                        <div class="question-text" id="question-text"></div>
                        <div class="verse-text" id="verse-text"></div>
                        <div class="options-container" id="options-container"></div>
                        <div class="result-text" id="result-text" style="display: none;"></div>
                    </div>
                    <div class="card-action">
                        <button class="btn btn-secondary waves-effect waves-light" id="next-btn" onclick="nextQuestion()" style="display: none;">Next Question</button>
                        <button class="btn btn-secondary waves-effect waves-light" id="stop-btn" onclick="stopQuiz()" style="display: none;">Stop Quiz</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let quranData = null;
        let currentQuestionIndex = 0;
        let selectedQuestionTypes = [1, 2, 3, 4];
        let selectedAnswer = null;
        let answered = false;
        let allAyahs = [];

        // Load the Quran data
        async function loadData() {
            try {
                const response = await fetch('juz8.json');
                quranData = await response.json();
                allAyahs = quranData.data.ayahs;
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('content').innerHTML = '<p style="color: red;">Error loading Quran data</p>';
            }
        }

        // Start quiz
        function startQuiz() {
            const type1 = document.getElementById('type1').checked;
            const type2 = document.getElementById('type2').checked;
            const type3 = document.getElementById('type3').checked;
            const type4 = document.getElementById('type4').checked;

            if (!type1 && !type2 && !type3 && !type4) {
                alert('Please select at least one question type');
                return;
            }

            selectedQuestionTypes = [];
            if (type1) selectedQuestionTypes.push(1);
            if (type2) selectedQuestionTypes.push(2);
            if (type3) selectedQuestionTypes.push(3);
            if (type4) selectedQuestionTypes.push(4);

            currentQuestionIndex = 0;
            document.getElementById('selection-screen').style.display = 'none';
            document.getElementById('question-screen').style.display = 'block';
            displayQuestion();
        }

        // Generate a random question
        function generateRandomQuestion() {
            const questionType = selectedQuestionTypes[Math.floor(Math.random() * selectedQuestionTypes.length)];
            
            if (questionType === 1) {
                return generateType1Question();
            } else if (questionType === 2) {
                return generateType2Question();
            } else if (questionType === 3) {
                return generateType3Question();
            } else if (questionType === 4) {
                return generateType4Question();
            }
        }

        // Question Type 1: Verse ends with X starts with Y
        function generateType1Question() {
            const randomIdx = Math.floor(Math.random() * (allAyahs.length - 1));
            const verse = allAyahs[randomIdx];
            const verseText = cleanArabicText(verse.text);
            const firstWords = getFirstWords(verseText, 3);
            const lastWords = getLastWords(verseText, 3);

            const correctOptions = [
                { text: firstWords, correct: true, full: verseText }
            ];

            // Add 3 random incorrect options
            const incorrectIndices = getRandomIndices(allAyahs.length, 3, randomIdx);
            incorrectIndices.forEach(idx => {
                const incorrectText = cleanArabicText(allAyahs[idx].text);
                correctOptions.push({
                    text: getFirstWords(incorrectText, 3),
                    correct: false,
                    full: incorrectText
                });
            });

            const shuffled = shuffleArray(correctOptions);

            return {
                type: 1,
                title: 'Complete the Verse',
                question: `The verse that ends with: <strong>"${lastWords}"</strong> starts with:`,
                options: shuffled,
                verseNumber: verse.number,
                surahNumber: verse.surah.number,
                surahName: verse.surah.englishName,
                numberInSurah: verse.numberInSurah,
                correctVerse: verseText
            };
        }

        // Question Type 2: Verse starts with X ends with Y
        function generateType2Question() {
            const randomIdx = Math.floor(Math.random() * (allAyahs.length - 1));
            const verse = allAyahs[randomIdx];
            const verseText = cleanArabicText(verse.text);
            const firstWords = getFirstWords(verseText, 3);
            const lastWords = getLastWords(verseText, 3);

            const correctOptions = [
                { text: lastWords, correct: true, full: verseText }
            ];

            // Add 3 random incorrect options
            const incorrectIndices = getRandomIndices(allAyahs.length, 3, randomIdx);
            incorrectIndices.forEach(idx => {
                const incorrectText = cleanArabicText(allAyahs[idx].text);
                correctOptions.push({
                    text: getLastWords(incorrectText, 3),
                    correct: false,
                    full: incorrectText
                });
            });

            const shuffled = shuffleArray(correctOptions);

            return {
                type: 2,
                title: 'Complete the Verse',
                question: `The verse that starts with: <strong>"${firstWords}"</strong> ends with:`,
                options: shuffled,
                verseNumber: verse.number,
                surahNumber: verse.surah.number,
                surahName: verse.surah.englishName,
                numberInSurah: verse.numberInSurah,
                correctVerse: verseText
            };
        }

        // Question Type 3: What is the next verse?
        function generateType3Question() {
            const randomIdx = Math.floor(Math.random() * (allAyahs.length - 2));
            const verse = allAyahs[randomIdx];
            const nextVerse = allAyahs[randomIdx + 1];
            const verseText = cleanArabicText(verse.text);
            const firstWordsOfNext = getFirstWords(cleanArabicText(nextVerse.text), 4);

            const correctOptions = [
                { text: firstWordsOfNext, correct: true, full: cleanArabicText(nextVerse.text) }
            ];

            // Add 3 random incorrect options
            const incorrectIndices = getRandomIndices(allAyahs.length, 3, randomIdx, randomIdx + 1);
            incorrectIndices.forEach(idx => {
                const incorrectText = cleanArabicText(allAyahs[idx].text);
                correctOptions.push({
                    text: getFirstWords(incorrectText, 4),
                    correct: false,
                    full: incorrectText
                });
            });

            const shuffled = shuffleArray(correctOptions);

            return {
                type: 3,
                title: 'Next Verse',
                question: `What is the verse after: <strong>"${getFirstWords(verseText, 4)}..."</strong>`,
                options: shuffled,
                verseNumber: nextVerse.number,
                surahNumber: nextVerse.surah.number,
                surahName: nextVerse.surah.englishName,
                numberInSurah: nextVerse.numberInSurah,
                correctVerse: cleanArabicText(nextVerse.text)
            };
        }

        // Question Type 4: What is the previous verse?
        function generateType4Question() {
            const randomIdx = Math.floor(Math.random() * (allAyahs.length - 2)) + 1;
            const verse = allAyahs[randomIdx];
            const prevVerse = allAyahs[randomIdx - 1];
            const verseText = cleanArabicText(verse.text);
            const firstWordsOfPrev = getFirstWords(cleanArabicText(prevVerse.text), 4);

            const correctOptions = [
                { text: firstWordsOfPrev, correct: true, full: cleanArabicText(prevVerse.text) }
            ];

            // Add 3 random incorrect options
            const incorrectIndices = getRandomIndices(allAyahs.length, 3, randomIdx, randomIdx - 1);
            incorrectIndices.forEach(idx => {
                const incorrectText = cleanArabicText(allAyahs[idx].text);
                correctOptions.push({
                    text: getFirstWords(incorrectText, 4),
                    correct: false,
                    full: incorrectText
                });
            });

            const shuffled = shuffleArray(correctOptions);

            return {
                type: 4,
                title: 'Previous Verse',
                question: `What is the verse before: <strong>"${getFirstWords(verseText, 4)}..."</strong>`,
                options: shuffled,
                verseNumber: prevVerse.number,
                surahNumber: prevVerse.surah.number,
                surahName: prevVerse.surah.englishName,
                numberInSurah: prevVerse.numberInSurah,
                correctVerse: cleanArabicText(prevVerse.text)
            };
        }

        // Helper functions
        function cleanArabicText(text) {
            return text.replace(/[\u064b-\u0652\u0640]/g, '').trim();
        }

        function getFirstWords(text, wordCount = 3) {
            const words = text.split(' ');
            return words.slice(0, wordCount).join(' ');
        }

        function getLastWords(text, wordCount = 3) {
            const words = text.split(' ');
            return words.slice(-wordCount).join(' ');
        }

        function getRandomIndices(total, count, exclude1, exclude2 = -1) {
            const indices = [];
            const excludeSet = new Set([exclude1, exclude2]);
            while (indices.length < count) {
                const idx = Math.floor(Math.random() * total);
                if (!excludeSet.has(idx) && !indices.includes(idx)) {
                    indices.push(idx);
                }
            }
            return indices;
        }

        function shuffleArray(arr) {
            const shuffled = [...arr];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Display current question
        function displayQuestion() {
            answered = false;
            selectedAnswer = null;
            const question = generateRandomQuestion();

            currentQuestionIndex++;
            document.getElementById('current-question').textContent = currentQuestionIndex;
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('question-title').textContent = question.title;
            document.getElementById('question-text').innerHTML = question.question;
            document.getElementById('verse-text').innerHTML = '';
            document.getElementById('result-text').style.display = 'none';
            document.getElementById('result-text').textContent = '';

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.innerHTML = `<strong>${String.fromCharCode(65 + index)}.</strong> ${option.text}`;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            // Store current question globally for submission
            window.currentQuestion = question;

            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
        }

        // Select an option
        function selectOption(index) {
            if (answered) return;

            answered = true;
            selectedAnswer = index;
            const question = window.currentQuestion;
            const selectedOption = question.options[selectedAnswer];
            const isCorrect = selectedOption.correct;

            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                const option = question.options[i];
                if (option.correct) {
                    opt.classList.add('correct');
                } else if (i === selectedAnswer && !isCorrect) {
                    opt.classList.add('incorrect');
                }
                opt.onclick = null; // Disable clicking after submission
            });

            const resultText = document.getElementById('result-text');
            resultText.style.display = 'block';
            if (isCorrect) {
                resultText.className = 'result-text result-correct';
                resultText.textContent = '✓ Correct!';
            } else {
                resultText.className = 'result-text result-incorrect';
                resultText.textContent = '✗ Incorrect!';
            }

            const fullVerseDiv = document.createElement('div');
            fullVerseDiv.className = 'full-verse';
            fullVerseDiv.innerHTML = `<strong>${question.surahName} ${question.surahNumber}:${question.numberInSurah}</strong><br>${question.correctVerse}`;
            resultText.parentElement.appendChild(fullVerseDiv);

            document.getElementById('next-btn').style.display = 'inline-block';
            document.getElementById('stop-btn').style.display = 'inline-block';
        }

        // Next question
        function nextQuestion() {
            const fullVerseDiv = document.querySelector('.full-verse');
            if (fullVerseDiv) {
                fullVerseDiv.remove();
            }
            displayQuestion();
        }

        // Stop quiz and return to selection
        function stopQuiz() {
            document.getElementById('selection-screen').style.display = 'block';
            document.getElementById('question-screen').style.display = 'none';
            currentQuestionIndex = 0;
        }

        // Initialize on page load
        window.addEventListener('load', loadData);
    </script>
</body>

</html>
